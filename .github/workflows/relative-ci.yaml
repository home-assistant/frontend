name: RelativeCI

on:
  workflow_run:
    workflows: [CI]
    types:
      - completed
    branches:
      - dev

jobs:
  upload:
    name: Upload stats
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    strategy:
      matrix:
        bundle: [frontend, supervisor]
        build: [modern, legacy]
    runs-on: ubuntu-latest
    steps:
      - name: Send bundle stats and build information to RelativeCI
        uses: relative-ci/agent-action@v2.1.8
        with:
          key: ${{ secrets[format('RELATIVE_CI_KEY_{1}_{2}', matrix.bundle, matrix.build)] }}
          token: ${{ github.token }}
          slug: ${{ format('{1}-{2}', matrix.bundle, matrix.build) }}
          artifactName: ${{ format('{1}-bundle-stats', matrix.bundle) }}
          artifactWebpackStatsFile: ${{ format('{1}-{2}.json', matrix.bundle, matrix.build) }}
