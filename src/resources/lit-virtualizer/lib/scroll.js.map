{"version":3,"file":"scroll.js","sourceRoot":"","sources":["../src/lib/scroll.ts"],"names":[],"mappings":"AAAA,OAAO,EAAkB,OAAO,EAAa,IAAI,EAAE,MAAM,KAAK,CAAC;AAC/D,OAAO,EAAE,SAAS,EAAY,QAAQ,EAAE,MAAM,kBAAkB,CAAC;AACjE,OAAO,EAAE,cAAc,EAAE,MAAM,wBAAwB,CAAC;AACxD,OAAO,EAAE,MAAM,EAAE,MAAM,0BAA0B,CAAC;AAElD,OAAO,EAAE,eAAe,EAAsB,MAAM,0CAA0C,CAAC;AAuC/F,MAAM,CAAC,MAAM,kBAAkB,GAAG,CAAC,IAAS,EAAE,EAAE,CAAC,IAAI,CAAC;AACtD,MAAM,CAAC,MAAM,iBAAiB,GAAG,CAAC,IAAS,EAAE,EAAE,CAAC,IAAI,CAAA,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,EAAE,IAAI,EAAE,CAAC,CAAC,EAAE,CAAC;AAEvF,MAAM,eAAgB,SAAQ,cAAc;IASxC,YAAY,IAAc;QACtB,KAAK,CAAC,IAAI,CAAC,CAAC;QAThB,cAAS,GAAuB,IAAI,CAAA;QACpC,aAAQ,GAA2B,IAAI,CAAA;QACvC,UAAK,GAAG,CAAC,CAAA;QACT,SAAI,GAAG,CAAC,CAAC,CAAA;QACT,eAAU,GAAkD,iBAAiB,CAAC;QAC9E,gBAAW,GAA2B,kBAAkB,CAAC;QACzD,UAAK,GAAmB,EAAE,CAAA;QAItB,IAAI,IAAI,CAAC,IAAI,KAAK,QAAQ,CAAC,KAAK,EAAE;YAC9B,MAAM,IAAI,KAAK,CAAC,4DAA4D,CAAC,CAAC;SACjF;IACL,CAAC;IAED,MAAM,CAAC,MAAqB;QACxB,IAAI,MAAM,EAAE;YACR,IAAI,CAAC,UAAU,GAAG,MAAM,CAAC,UAAU,IAAI,IAAI,CAAC,UAAU,CAAC;YACvD,IAAI,CAAC,WAAW,GAAG,MAAM,CAAC,WAAW,IAAI,IAAI,CAAC,WAAW,CAAC;SAC7D;QACD,MAAM,aAAa,GAAG,EAAE,CAAC;QACzB,IAAI,IAAI,CAAC,KAAK,IAAI,CAAC,IAAI,IAAI,CAAC,IAAI,IAAI,IAAI,CAAC,KAAK,EAAE;YAC5C,KAAK,IAAI,CAAC,GAAG,IAAI,CAAC,KAAK,EAAE,CAAC,GAAG,IAAI,CAAC,IAAI,GAAG,CAAC,EAAE,CAAC,EAAE,EAAE;gBAC7C,aAAa,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;aACrC;SACJ;QACD,OAAO,MAAM,CAAC,aAAa,EAAE,IAAI,CAAC,WAAW,IAAI,kBAAkB,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC;IAC1F,CAAC;IAED,MAAM,CAAC,IAAe,EAAE,CAAC,MAAM,CAAiB;;QAC5C,IAAI,IAAI,CAAC,QAAQ,IAAI,IAAI,CAAC,WAAW,CAAC,IAAI,EAAE,MAAM,CAAC,EAAE;YACjD,MAAM,EAAE,QAAQ,EAAE,GAAG,IAAI,CAAC;YAC1B,IAAI,CAAC,KAAK,GAAG,QAAS,CAAC,KAAK,GAAG,MAAM,CAAC,KAAK,IAAI,EAAE,CAAC;YAClD,QAAS,CAAC,UAAU,GAAG,MAAM,CAAC,UAAU,KAAI,MAAA,MAAM,CAAC,KAAK,0CAAE,MAAM,CAAA,IAAI,CAAC,CAAC;YACtE,QAAS,CAAC,MAAM,GAAG,MAAM,CAAC,MAAM,IAAI,IAAI,CAAC;YACzC,QAAS,CAAC,YAAY,GAAG,MAAM,CAAC,YAAY,IAAI,IAAI,CAAC,SAAS,CAAC;YAC/D,IAAI,MAAM,CAAC,aAAa,EAAE;gBACtB,QAAS,CAAC,aAAa,GAAG,MAAM,CAAC,aAAa,CAAC;aAClD;YACD,OAAO,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;SAC9B;QACD,OAAO,OAAO,CAAC;IACnB,CAAC;IAEO,WAAW,CAAC,IAAe,EAAE,MAAoB;QACrD,MAAM,SAAS,GAAG,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,UAAyB,CAAC;QAClE,IAAI,SAAS,IAAI,SAAS,CAAC,QAAQ,KAAK,CAAC,EAAE;YACvC,IAAI,CAAC,QAAQ,GAAG,IAAI,eAAe,CAAC,EAAE,SAAS,EAAE,CAAC,CAAC;YACnD,SAAS,CAAC,gBAAgB,CAAC,cAAc,EAAE,CAAC,CAAQ,EAAE,EAAE;gBACpD,IAAI,CAAC,KAAK,GAAI,CAAiB,CAAC,MAAM,CAAC,KAAK,CAAC;gBAC7C,IAAI,CAAC,IAAI,GAAI,CAAiB,CAAC,MAAM,CAAC,IAAI,CAAC;gBAC3C,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,MAAM,EAAE,CAAC,CAAC;YACjC,CAAC,CAAC,CAAC;YACH,OAAO,IAAI,CAAC;SACf;QACD,oEAAoE;QACpE,wEAAwE;QACxE,yCAAyC;QACzC,OAAO,CAAC,OAAO,EAAE,CAAC,IAAI,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,EAAE,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;QAC1D,OAAO,KAAK,CAAC;IACjB,CAAC;CACJ;AAED,MAAM,CAAC,MAAM,MAAM,GAAG,SAAS,CAAC,eAAe,CAAC,CAAC","sourcesContent":["import { TemplateResult, nothing, ChildPart, html } from 'lit';\nimport { directive, PartInfo, PartType } from 'lit/directive.js';\nimport { AsyncDirective } from 'lit/async-directive.js';\nimport { repeat } from 'lit/directives/repeat.js';\nimport { Layout, LayoutConstructor, LayoutSpecifier } from './uni-virtualizer/lib/layouts/Layout.js';\nimport { VirtualScroller, ScrollToIndexValue } from './uni-virtualizer/lib/VirtualScroller.js';\n\n/**\n * Configuration options for the scroll directive.\n */\ninterface ScrollConfig {\n    /**\n     * A function that returns a lit-html TemplateResult. It will be used\n     * to generate the DOM for each item in the virtual list.\n     */\n    renderItem?: (item: any, index?: number) => TemplateResult;\n\n    keyFunction?: (item: any) => unknown;\n  \n    // TODO (graynorton): Document...\n    layout?: Layout | LayoutConstructor | LayoutSpecifier | null;\n  \n    /**\n     * An element that receives scroll events for the virtual scroller.\n     */\n    scrollTarget?: Element | Window;\n  \n    /**\n     * The list of items to display via the renderItem function.\n     */\n    items?: Array<any>;\n  \n    /**\n     * Limit for the number of items to display. Defaults to the length of the\n     * items array.\n     */\n    totalItems?: number;\n  \n    /**\n     * Index and position of the item to scroll to.\n     */\n    scrollToIndex?: ScrollToIndexValue;\n  }\n  \nexport const defaultKeyFunction = (item: any) => item;\nexport const defaultRenderItem = (item: any) => html`${JSON.stringify(item, null, 2)}`;\n\nclass ScrollDirective extends AsyncDirective {\n    container: HTMLElement | null = null\n    scroller: VirtualScroller | null = null\n    first = 0\n    last = -1\n    renderItem: (item: any, index?: number) => TemplateResult = defaultRenderItem;\n    keyFunction: (item: any) => unknown = defaultKeyFunction;\n    items: Array<unknown> = []\n\n    constructor(part: PartInfo) {\n        super(part);\n        if (part.type !== PartType.CHILD) {\n            throw new Error('The scroll directive can only be used in child expressions');\n        }\n    }\n    \n    render(config?: ScrollConfig) {\n        if (config) {\n            this.renderItem = config.renderItem || this.renderItem;\n            this.keyFunction = config.keyFunction || this.keyFunction;\n        }\n        const itemsToRender = [];\n        if (this.first >= 0 && this.last >= this.first) {\n            for (let i = this.first; i < this.last + 1; i++) {\n                itemsToRender.push(this.items[i]);\n            }    \n        }\n        return repeat(itemsToRender, this.keyFunction || defaultKeyFunction, this.renderItem);\n    }\n\n    update(part: ChildPart, [config]: [ScrollConfig]) {\n        if (this.scroller || this._initialize(part, config)) {\n            const { scroller } = this;\n            this.items = scroller!.items = config.items || [];\n            scroller!.totalItems = config.totalItems || config.items?.length || 0;\n            scroller!.layout = config.layout || null;\n            scroller!.scrollTarget = config.scrollTarget || this.container;\n            if (config.scrollToIndex) {\n                scroller!.scrollToIndex = config.scrollToIndex;\n            }\n            return this.render(config);    \n        }\n        return nothing;\n    }\n\n    private _initialize(part: ChildPart, config: ScrollConfig) {\n        const container = this.container = part.parentNode as HTMLElement;\n        if (container && container.nodeType === 1) {\n            this.scroller = new VirtualScroller({ container });\n            container.addEventListener('rangeChanged', (e: Event) => {\n                this.first = (e as CustomEvent).detail.first;\n                this.last = (e as CustomEvent).detail.last;\n                this.setValue(this.render());\n            });\n            return true;\n        }\n        // TODO (GN): This seems to be needed in the case where the `scroll`\n        // directive is used within the `LitVirtualizer` element. Figure out why\n        // and see if there's a cleaner solution.\n        Promise.resolve().then(() => this.update(part, [config]));\n        return false;\n    }\n}\n\nexport const scroll = directive(ScrollDirective);"]}