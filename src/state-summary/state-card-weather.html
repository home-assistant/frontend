<link rel="import" href="../../bower_components/polymer/polymer.html">

<link rel="import" href="../../bower_components/google-apis/google-legacy-loader.html">

<dom-module id="state-card-weather">
  <template>
      <google-legacy-loader on-api-load="googleApiLoaded"></google-legacy-loader>
    </template>
  </template>
</dom-module>

<script>
Polymer({
  is: 'state-card-weather',

  properties: {
    stateObj: {
      type: Object,
      observer: 'dataChanged',
    },

    chartEngine: {
      type: Object,
    },

    isAttached: {
      type: Boolean,
      value: false,
      observer: 'dataChanged',
    }
  },

  attached: function () {
    this.isAttached = true;
  },

  dataChanged: function() {
    this.drawChart();
  },

  getDataArray: function() {
    if(!this.stateObj.attributes.forecast) {
      return;
    }

    var dataArray = [];
    var data = this.stateObj.attributes.forecast;

    for(var i =0; i < data.length; i++) {
      dataArray.push([new Date(data[i].datetime), data[i].temp]);
    }

    return dataArray;
  },

  drawChart: function() {
    if(!this.isAttached) {
      return;
    }

    if(!window.google) {
      return;
    }

    if(!this.chartEngine) {
      this.chartEngine = new window.google.visualization.LineChart(this);
    }

    var dataGrid = new window.google.visualization.DataTable();
    dataGrid.addColumn('datetime', 'Time');
    dataGrid.addColumn('number', 'temperature');

    dataGrid.addRows(this.getDataArray());

      var options = {
        legend: {
          position: 'top'
        },
        interpolateNulls: true,
        titlePosition: 'none',
        vAxes: {
          0: { title: "Celcius" },
        },
        legend: {
          position: 'top',
          title: 'Box Office Earnings in First Two Weeks of Opening',
          subtitle: 'in millions of dollars (USD)'   
        },
        chartArea: {
            left: 25,
            top: 5,
            height: '90%',
            width: '90%',
        }
      };

      this.chartEngine.draw(dataGrid, options);
  },

   googleApiLoaded: function () {
    window.google.load('visualization', '1', {
      packages: ['corechart'],
      callback: function () {
          this.dataChanged();
        this.apiLoaded = true;
      }.bind(this),
    });
  },
});
</script>