<script type="module" src="../../node_modules/@polymer/polymer/polymer-element.js"></script>
<script type="module" src="../../node_modules/@polymer/iron-media-query/iron-media-query.js"></script>
<script type="module" src="../../node_modules/@polymer/app-route/app-route.js"></script>

<script type="module" src="../../src/layouts/hass-error-screen.js"></script>
<script type="module" src="../../src/util/hass-mixins.js"></script>

<script type="module" src="./dashboard/ha-config-dashboard.js"></script>
<script type="module" src="./core/ha-config-core.js"></script>
<script type="module" src="./cloud/ha-config-cloud.js"></script>
<script type="module" src="./automation/ha-config-automation.js"></script>
<script type="module" src="./script/ha-config-script.js"></script>
<script type="module" src="./zwave/ha-config-zwave.js"></script>
<script type="module" src="./customize/ha-config-customize.js"></script>
<script type="module" src="./config-entries/ha-config-entries.js"></script>

<dom-module id="ha-panel-config">
  <template>
    <app-route
      route='[[route]]'
      pattern='/:page'
      data="{{_routeData}}"
    ></app-route>

    <iron-media-query query="(min-width: 1040px)" query-matches="{{wide}}">
    </iron-media-query>
    <iron-media-query query="(min-width: 1296px)" query-matches="{{wideSidebar}}">
    </iron-media-query>

    <template is="dom-if" if='[[_equals(_routeData.page, "core")]]' restamp>
      <ha-config-core
        page-name='core'
        hass='[[hass]]'
        is-wide='[[isWide]]'
      ></ha-config-core>
    </template>

    <template is="dom-if" if='[[_equals(_routeData.page, "cloud")]]' restamp>
      <ha-config-cloud
        page-name='cloud'
        route='[[route]]'
        hass='[[hass]]'
        is-wide='[[isWide]]'
        account='[[account]]'
      ></ha-config-cloud>
    </template>

    <template is="dom-if" if='[[_equals(_routeData.page, "dashboard")]]'>
      <ha-config-dashboard
        page-name='dashboard'
        hass='[[hass]]'
        is-wide='[[isWide]]'
        account='[[account]]'
        narrow='[[narrow]]'
        show-menu='[[showMenu]]'
      ></ha-config-dashboard>
    </template>

    <template is="dom-if" if='[[_equals(_routeData.page, "automation")]]' restamp>
      <ha-config-automation
        page-name='automation'
        route='[[route]]'
        hass='[[hass]]'
        is-wide='[[isWide]]'
      ></ha-config-automation>
    </template>

    <template is="dom-if" if='[[_equals(_routeData.page, "script")]]' restamp>
      <ha-config-script
        page-name='script'
        route='[[route]]'
        hass='[[hass]]'
        is-wide='[[isWide]]'
      ></ha-config-script>
    </template>

    <template is="dom-if" if='[[_equals(_routeData.page, "zwave")]]' restamp>
      <ha-config-zwave
        page-name='zwave'
        hass='[[hass]]'
        is-wide='[[isWide]]'
      ></ha-config-zwave>
    </template>

    <template is="dom-if" if='[[_equals(_routeData.page, "customize")]]' restamp>
      <ha-config-customize
        page-name='customize'
        hass='[[hass]]'
        is-wide='[[isWide]]'
      ></ha-config-customize>
    </template>

    <template is="dom-if" if='[[_equals(_routeData.page, "integrations")]]' restamp>
      <ha-config-entries
        page-name='integrations'
        hass='[[hass]]'
        is-wide='[[isWide]]'
      ></ha-config-entries>
    </template>
  </template>
</dom-module>

<script type="module">
import { PolymerElement } from '@polymer/polymer/polymer-element.js';
import '@polymer/iron-media-query/iron-media-query.js';
import '@polymer/app-route/app-route.js';
import '../../src/layouts/hass-error-screen.js';
import '../../src/util/hass-mixins.js';
import './dashboard/ha-config-dashboard.js';
import './core/ha-config-core.js';
import './cloud/ha-config-cloud.js';
import './automation/ha-config-automation.js';
import './script/ha-config-script.js';
import './zwave/ha-config-zwave.js';
import './customize/ha-config-customize.js';
import './config-entries/ha-config-entries.js';
class HaPanelConfig extends window.hassMixins.NavigateMixin(PolymerElement) {
  static get is() { return 'ha-panel-config'; }

  static get properties() {
    return {
      hass: Object,
      narrow: Boolean,
      showMenu: Boolean,
      account: Object,

      route: {
        type: Object,
        observer: '_routeChanged',
      },

      _routeData: Object,

      wide: Boolean,
      wideSidebar: Boolean,

      isWide: {
        type: Boolean,
        computed: 'computeIsWide(showMenu, wideSidebar, wide)'
      },
    };
  }

  ready() {
    super.ready();
    if (window.hassUtil.isComponentLoaded(this.hass, 'cloud')) {
      this.hass.callApi('get', 'cloud/account').then((account) => { this.account = account; });
    }
    this.addEventListener('ha-account-refreshed', (ev) => {
      this.account = ev.detail.account;
    });
  }

  computeIsWide(showMenu, wideSidebar, wide) {
    return showMenu ? wideSidebar : wide;
  }

  _routeChanged(route) {
    if (route.path === '' && route.prefix === '/config') {
      this.navigate('/config/dashboard', true);
    }
  }

  _equals(a, b) {
    return a === b;
  }
}

customElements.define(HaPanelConfig.is, HaPanelConfig);
</script>
