<link rel='import' href='../../bower_components/polymer/polymer-element.html'>
<link rel='import' href='../../bower_components/paper-card/paper-card.html'>

<link rel='import' href='../../src/util/hass-mixins.html'>

<link rel='import' href='../components/hassio-item-info.html'>
<link rel='import' href='../hassio-style.html'>

<dom-module id='hassio-dashboard-addons'>
  <template>
    <style include='hassio-style'></style>
    <style include='iron-flex ha-style'>
      paper-card {
        cursor: pointer;
      }
    </style>
    <div class='content card-group'>
      <div class='title'>Add-ons</div>
      <template is='dom-if' if='[[!addons.length]]'>
        <paper-card>
          <div class='card-content'>
            You don't have any add-ons installed yet. Head over to <a href='#' on-tap='openStore'>the add-on store</a> to get started!
          </div>
        </paper-card>
      </template>

      <template is='dom-repeat' items='[[addons]]' as='addon' sort='sortAddons'>
        <paper-card on-click='addonTapped'>
          <div class='card-content'>
            <hassio-item-info
              title='[[addon.name]]'
              description='[[addon.description]]'
              icon='[[computeIcon(addon)]]'
              icon-title='[[computeIconTitle(addon)]]'
              icon-class='[[computeIconClass(addon)]]'
            ></hassio-item-info>
          </div>
        </paper-card>
      </template>
    </div>
  </template>
</dom-module>

<script>
class HassioDashboardAddons extends window.hassMixins.EventsMixin(Polymer.Element) {
  static get is() { return 'hassio-dashboard-addons'; }

  static get properties() {
    return {
      addons: Array,
    };
  }

  sortAddons(a, b) {
    return a.name < b.name ? -1 : 1;
  }

  computeIcon(addon) {
    return addon.installed !== addon.version ? 'mdi:arrow-up-bold-circle' : 'mdi:puzzle';
  }

  computeIconTitle(addon) {
    if (addon.installed !== addon.version) return 'New version available';
    return addon.state === 'started' ? 'Add-on is running' : 'Add-on is stopped';
  }

  computeIconClass(addon) {
    if (addon.installed !== addon.version) return 'update';
    return addon.state === 'started' ? 'running' : '';
  }

  addonTapped(ev) {
    history.pushState(null, null, '/hassio/addon/' + ev.model.addon.slug);
    this.fire('location-changed');
    ev.target.blur();
  }

  openStore(ev) {
    history.pushState(null, null, '/hassio/store');
    this.fire('location-changed');
    ev.target.blur();
  }
}
customElements.define(HassioDashboardAddons.is, HassioDashboardAddons);
</script>
